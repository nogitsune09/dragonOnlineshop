using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using Customer.ViewModel;

namespace Customer.Business
{
    public class CustomerBusiness
    {
        private string connectionString = "your_connection_string_here";

        public string InsertCustomer(string firstName, string lastName, string phoneNumber, string email)
        {
            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("InsertCustomer", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@FirstName", firstName);
                    cmd.Parameters.AddWithValue("@LastName", lastName);
                    cmd.Parameters.AddWithValue("@PhoneNumber", phoneNumber);
                    cmd.Parameters.AddWithValue("@Email", email);

                    conn.Open();
                    cmd.ExecuteNonQuery();
                    conn.Close();
                }
            }
            return "OK";
        }

        public string UpdateCustomer(int customerId, string firstName, string lastName, string phoneNumber, string email)
        {
            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("UpdateCustomer", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@CustomerID", customerId);
                    cmd.Parameters.AddWithValue("@FirstName", firstName);
                    cmd.Parameters.AddWithValue("@LastName", lastName);
                    cmd.Parameters.AddWithValue("@PhoneNumber", phoneNumber);
                    cmd.Parameters.AddWithValue("@Email", email);

                    conn.Open();
                    cmd.ExecuteNonQuery();
                    conn.Close();
                }
            }
            return "OK";
        }

        public string DeleteCustomer(int customerId)
        {
            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("DeleteCustomer", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@CustomerID", customerId);

                    conn.Open();
                    cmd.ExecuteNonQuery();
                    conn.Close();
                }
            }
            return "OK";
        }

        public DataSet GetAllCustomers()
        {
            DataSet result = new DataSet();

            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("GetAllCustomers", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;

                    conn.Open();
                    using (SqlDataAdapter adapter = new SqlDataAdapter(cmd))
                    {
                        adapter.Fill(result);
                    }
                    conn.Close();
                }
            }

            return result;
        }

        public DataSet GetCustomerByID(int customerId)
        {
            DataSet result = new DataSet();

            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("GetCustomerByID", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@CustomerID", customerId);

                    conn.Open();
                    using (SqlDataAdapter adapter = new SqlDataAdapter(cmd))
                    {
                        adapter.Fill(result);
                    }
                    conn.Close();
                }
            }

            return result;
        }

        public List<vmCustomer> SearchCustomersByFirstName(string firstName)
        {
            List<vmCustomer> finalResult = new List<vmCustomer>();

            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("SearchCustomersByFirstName", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@FirstName", firstName);

                    conn.Open();
                    using (SqlDataAdapter adapter = new SqlDataAdapter(cmd))
                    {
                        DataSet dsResult = new DataSet();
                        adapter.Fill(dsResult);

                        if (dsResult.Tables.Count > 0)
                        {
                            for (int i = 0; i < dsResult.Tables[0].Rows.Count; i++)
                            {
                                vmCustomer result = new vmCustomer
                                {
                                    CustomerID = Convert.ToInt32(dsResult.Tables[0].Rows[i]["CustomerID"]),
                                    FirstName = dsResult.Tables[0].Rows[i]["FirstName"].ToString(),
                                    LastName = dsResult.Tables[0].Rows[i]["LastName"].ToString(),
                                    PhoneNumber = dsResult.Tables[0].Rows[i]["PhoneNumber"].ToString(),
                                    Email = dsResult.Tables[0].Rows[i]["Email"].ToString()
                                };
                                finalResult.Add(result);
                            }
                        }
                    }
                    conn.Close();
                }
            }

            return finalResult;
        }

        public List<vmCustomer> SearchCustomersByLastName(string lastName)
        {
            List<vmCustomer> finalResult = new List<vmCustomer>();

            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("SearchCustomersByLastName", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@LastName", lastName);

                    conn.Open();
                    using (SqlDataAdapter adapter = new SqlDataAdapter(cmd))
                    {
                        DataSet dsResult = new DataSet();
                        adapter.Fill(dsResult);

                        if (dsResult.Tables.Count > 0)
                        {
                            for (int i = 0; i < dsResult.Tables[0].Rows.Count; i++)
                            {
                                vmCustomer result = new vmCustomer
                                {
                                    CustomerID = Convert.ToInt32(dsResult.Tables[0].Rows[i]["CustomerID"]),
                                    FirstName = dsResult.Tables[0].Rows[i]["FirstName"].ToString(),
                                    LastName = dsResult.Tables[0].Rows[i]["LastName"].ToString(),
                                    PhoneNumber = dsResult.Tables[0].Rows[i]["PhoneNumber"].ToString(),
                                    Email = dsResult.Tables[0].Rows[i]["Email"].ToString()
                                };
                                finalResult.Add(result);
                            }
                        }
                    }
                    conn.Close();
                }
            }

            return finalResult;
        }

        public List<vmCustomer> SearchCustomersByPhoneNumber(string phoneNumber)
        {
            List<vmCustomer> finalResult = new List<vmCustomer>();

            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("SearchCustomersByPhoneNumber", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@PhoneNumber", phoneNumber);

                    conn.Open();
                    using (SqlDataAdapter adapter = new SqlDataAdapter(cmd))
                    {
                        DataSet dsResult = new DataSet();
                        adapter.Fill(dsResult);

                        if (dsResult.Tables.Count > 0)
                        {
                            for (int i = 0; i < dsResult.Tables[0].Rows.Count; i++)
                            {
                                vmCustomer result = new vmCustomer
                                {
                                    CustomerID = Convert.ToInt32(dsResult.Tables[0].Rows[i]["CustomerID"]),
                                    FirstName = dsResult.Tables[0].Rows[i]["FirstName"].ToString(),
                                    LastName = dsResult.Tables[0].Rows[i]["LastName"].ToString(),
                                    PhoneNumber = dsResult.Tables[0].Rows[i]["PhoneNumber"].ToString(),
                                    Email = dsResult.Tables[0].Rows[i]["Email"].ToString()
                                };
                                finalResult.Add(result);
                            }
                        }
                    }
                    conn.Close();
                }
            }

            return finalResult;
        }

        public List<vmCustomer> SearchCustomersByEmail(string email)
        {
            List<vmCustomer> finalResult = new List<vmCustomer>();

            using (SqlConnection conn = new SqlConnection(connectionString))
            {
                using (SqlCommand cmd = new SqlCommand("SearchCustomersByEmail", conn))
                {
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("@Email", email);

                    conn.Open();
                    using (SqlDataAdapter adapter = new SqlDataAdapter(cmd))
                    {
                        DataSet dsResult = new DataSet();
                        adapter.Fill(dsResult);

                        if (dsResult.Tables.Count > 0)
                        {
                            for (int i = 0; i < dsResult.Tables[0].Rows.Count; i++)
                            {
                                vmCustomer result = new vmCustomer
                                {
                                    CustomerID = Convert.ToInt32(dsResult.Tables[0].Rows[i]["CustomerID"]),
                                    FirstName = dsResult.Tables[0].Rows[i]["FirstName"].ToString(),
                                    LastName = dsResult.Tables[0].Rows[i]["LastName"].ToString(),
                                    PhoneNumber = dsResult.Tables[0].Rows[i]["PhoneNumber"].ToString(),
                                    Email = dsResult.Tables[0].Rows[i]["Email"].ToString()
                                };
                                finalResult.Add(result);
                            }
                        }
                    }
                    conn.Close();
                }
            }

            return finalResult;
        }
    }
}
